<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */
?>
<?= $this->doctype() ?>
<html lang="es">
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="<?= $this->basePath('/img/favicon.png') ?>">
    
    <?= $this->headTitle()->setSeparator(' - ')->setAutoEscape(false) ?>
    
    <?= $this->headMeta()
        ->appendName('viewport', 'width=device-width, initial-scale=1.0')
        ->appendHttpEquiv('X-UA-Compatible', 'IE=edge')
    ?>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">

    <!-- Styles -->
    <?= $this->headLink()
        ->appendStylesheet('https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css')
        ->appendStylesheet('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css')
        ->appendStylesheet($this->basePath('css/jquery-ui.css'))
        ->appendStylesheet($this->basePath('css/bootstrap-toggle.min.css'))
        ->appendStylesheet($this->basePath('css/bootstrap-combobox.css'))
        ->appendStylesheet($this->basePath('css/fullcalendar.css'))
        ->appendStylesheet($this->basePath('css/style.css'))
    ?>

    <!-- Scripts -->
    <script src="<?= $this->basePath('/js/jquery.js') ?>"></script>
    <script src="<?= $this->basePath('/js/autoNumeric.js') ?>"></script>
    <script>baseUrl = "<?= $this->basePath() ?>"</script>
    
    <?= $this->headScript() ?>

    <style>
        /* Estilos para mantener la apariencia similar al diseño original */
        .main-navbar {
            background-color: #2c3e50 !important;
            border-bottom: 1px solid #34495e;
            min-height: 50px;
        }
        
        .brand-container {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }
        
        .brand-container img {
            margin-right: 10px;
        }
        
        .navbar-nav .nav-link {
            color: #ffffff !important;
            padding: 8px 15px !important;
        }
        
        .navbar-nav .nav-link:hover {
            background-color: #34495e;
            border-radius: 3px;
        }
        
        .container-fluid.body {
            padding-top: 20px;
        }
        
        .box.contenido {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Modal loading styles */
        .ctn-modal-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-loading-body {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            min-width: 300px;
        }
        
        .modal-title--text {
            margin-bottom: 20px;
            color: #333;
        }
        
        .d-none {
            display: none !important;
        }

        /* Notification styles */
        .notify {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
    </style>
</head>

<body>
    <?php 
    // Simulamos las variables de sesión para mantener compatibilidad
    // En tu implementación real, deberías adaptar esto a tu sistema de autenticación de Laminas
    $auth = new stdClass(); // Reemplazar con tu sistema de auth
    $global = new stdClass(); // Reemplazar con tu sistema global
    ?>

    <!-- Header tiempo (si existe) -->
    <?= $this->partial("_headertiempo.phtml") ?? '' ?>
    
    <!-- Main Navigation -->
    <nav class="navbar navbar-expand-lg main-navbar">
        <div class="container-fluid">
            <!-- Brand/Logo -->
            <div class="brand-container">
                <img src="<?= $this->basePath('/img' . (defined('PUBLIC_PATH') ? PUBLIC_PATH : '') . '/logo_zt1.png') ?>" 
                     style="height: 30px;" alt="Logo 1">
                <img src="<?= $this->basePath('/img' . (defined('PUBLIC_PATH') ? PUBLIC_PATH : '') . '/logo_zt2.png') ?>" 
                     style="height: 15px;" alt="Logo 2">
            </div>

            <!-- Mobile toggle button -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" 
                    aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navigation content -->
            <div class="collapse navbar-collapse" id="navbarContent">
                <!-- Left side navigation -->
                <ul class="navbar-nav me-auto">
                    <!-- Notificaciones -->
                    <?php if ($this->partial("notificacion.phtml", ["auth" => $auth])): ?>
                        <li class="nav-item">
                            <?= $this->partial("notificacion.phtml", ["auth" => $auth]) ?>
                        </li>
                    <?php endif; ?>
                    
                 
                </ul>

                <!-- Right side navigation -->
                <ul class="navbar-nav ms-auto">
                    <!-- Menu principal -->
                    <?php if ($this->partial("menu.phtml", ["auth" => $auth, "baseUrl" => $this->basePath()])): ?>
                        <?= $this->partial("menu.phtml", ["auth" => $auth, "baseUrl" => $this->basePath()]) ?>
                    <?php endif; ?>
                    
                    <!-- Empresa actual -->
                    <?php if ($this->partial("empresaactual.phtml", ["global" => $global, "baseUrl" => $this->basePath()])): ?>
                        <?= $this->partial("empresaactual.phtml", ["global" => $global, "baseUrl" => $this->basePath()]) ?>
                    <?php endif; ?>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid body">
        <div class="row">
            <div class="col-12">
                <div class="box contenido">
                    <?= $this->content ?>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modals -->
    <div class="ctn-modal-loading d-none" id="modal_loading">
        <div class="modal-loading-body">
            <div class="modal-loading-body-lottie">
                <h5 class="modal-title modal-title--text">Procesando...</h5>
                <div id="lottie-container" style="height: 150px;"></div>
            </div>
        </div>
    </div>

    <div class="ctn-modal-loading d-none" id="modal_loading_layout1">
        <div class="modal-loading-body">
            <div class="modal-loading-body-lottie">
                <h5 class="modal-title modal-title--text">Cargando contrato...</h5>
                <div id="lottie-container2" style="height: 150px;"></div>
            </div>
        </div>
    </div>

    <!-- Modal para activar Caudata -->
    <div class="modal fade" id="msga" tabindex="-1" aria-labelledby="msgaLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header alert alert-warning">
                    <h5 class="modal-title" id="msgaLabel">Contrata Caudata</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body alert alert-warning">
                    <strong>
                        Que alegría saber que serás nuestro cliente, haz click en "Enviar Correo", 
                        y un asesor se comunicara contigo para concretar los detalles del servicio.
                        <br><br>Lindo día
                    </strong>
                </div>
                <div class="modal-footer" style="background: rgb(251, 238, 213) !important;">
                    <button id="enviocorreo" type="button" class="btn btn-warning">Enviar Correo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification container -->
    <div class="notify"></div>

    <!-- Footer -->
    <?= $this->partial("footer.phtml", ["global" => $global, "baseUrl" => $this->basePath()]) ?? '' ?>

    <!-- Scripts -->
    <?= $this->inlineScript()
        ->prependFile('https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js')
        ->prependFile($this->basePath('js/lottie.min.js'))
        ->prependFile($this->basePath('js/bootstrap-toggle.min.js'))
        ->prependFile($this->basePath('js/ckeditor/adapters/jquery.js'))
        ->prependFile($this->basePath('js/ckeditor/ckeditor.js'))
        ->prependFile($this->basePath('js/bootstrap-combobox.js'))
        ->prependFile($this->basePath('js/jquery-ui-sliderAccess.js'))
        ->prependFile($this->basePath('js/jquery-ui-timepicker-addon.js'))
        ->prependFile($this->basePath('js/jquery-ui-1.9.1.custom.min.js'))
        ->prependFile($this->basePath('js/jquery.dataTables.min.js'))
        ->prependFile($this->basePath('js/bootstrap-notify.js'))
        ->prependFile($this->basePath('js/jquery.validate.min.js'))
        ->prependFile($this->basePath('js/jquery-ui-1.10.3.dialog.min.js'))
        ->prependFile($this->basePath('js/formularios.js'))
        ->prependFile($this->basePath('js/listado.js'))
        ->prependFile($this->basePath('js/scripts_generales.js'))
    ?>

    <!-- Google Charts (si es necesario) -->
    <?php if (defined('PUBLIC_PATH') && (PUBLIC_PATH == "/aw" || $this->layout()->googlechart == true)): ?>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load('visualization', '1.0', {'packages':['corechart']});
        </script>
    <?php endif; ?>

    <script type="text/javascript">
        $(document).ready(function(){
            // Activar Caudata functionality
            $('.activarcaudata').click(function(event){
                event.preventDefault();
                var modal = new bootstrap.Modal(document.getElementById('msga'));
                modal.show();
            });

            // Envio correo asesor
            $('#enviocorreo').click(function(event){
                $.post("<?= $this->basePath() ?>/default/index/enviarcorreoasesor", 
                    { "estado": "" },
                    function(data) {
                        alert("Se envió el correo al asesor, él se comunicará contigo lo más pronto posible.");
                        var modal = bootstrap.Modal.getInstance(document.getElementById('msga'));
                        modal.hide();
                    }
                );
            });

            // Lottie animations
            if (typeof lottie !== 'undefined') {
                lottie.loadAnimation({
                    container: document.getElementById('lottie-container'),
                    renderer: 'svg',
                    loop: true,
                    autoplay: true,
                    path: "https://aw.dataemunah.com/js/animation-lottie.json",
                });

                lottie.loadAnimation({
                    container: document.getElementById('lottie-container2'),
                    renderer: 'svg',
                    loop: true,
                    autoplay: true,
                    path: "https://aw.dataemunah.com/js/animation-lottie.json",
                });
            }
        });

        // Función para mostrar loader (compatibilidad)
        function show_loader() {
            document.getElementById('modal_loading').classList.remove('d-none');
        }

        // Función para ocultar loader (compatibilidad)
        function hide_loader() {
            document.getElementById('modal_loading').classList.add('d-none');
        }
    </script>
</body>
</html>